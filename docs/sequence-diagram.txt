# https://sequencediagram.org

bottomparticipants

title ExtAuthz with proxied IDP response

actor Client

==Not logged in==

Client->Gateway:Orig req
Gateway->Pre:Orig req
Pre->ExtAuthz:Auth req
ExtAuthz->VS AUTH:Auth req
VS AUTH->CLUSTER AUTH:Auth req
CLUSTER AUTH->Authorizer:Auth req
Authorizer->IDP:IDP auth req
IDP->Authorizer:IDP auth res: !200 
Authorizer->ExtAuthz:Auth res: !200
ExtAuthz->Post:Auth res: !200
Post->Client:Auth res: 303
Client->IDP:Login
IDP->Gateway:IDP res
Gateway->VS IDPRES:IDP res
VS IDPRES->CLUSTER IDPRES:IDP res
CLUSTER IDPRES->Authorizer:IDP res
Authorizer->Client:Orig req

==Logged in==

Client->Gateway:Orig req
Gateway->Pre:Orig req
Pre->ExtAuthz:Auth req
ExtAuthz->VS AUTH:Auth req
VS AUTH->CLUSTER AUTH:Auth req
CLUSTER AUTH->Authorizer:Auth req
Authorizer->IDP:IDP auth req
IDP->Authorizer:IDP auth res: 200 
Authorizer->ExtAuthz:Auth res: 200
ExtAuthz->Post:Auth res: 200
Post->Service:Original request + user info
Service->Client:Response

